{
  "@name":"puppet1",
  "repositories":{
    "@kind":"TAR",
    "urls":"http://www.apache.org/dist/hadoop/common/"
  },
  "configuration":{
    "category":[
      {
        "@name":"ambari",
        "property":[
          {
            "@name":"ambari_namenode_principal",
            "@value":"nn"
          },
          {
            "@name":"ambari_datanode_principal",
            "@value":"dn"
          },
          {
            "@name":"ambari_jobtracker_principal",
            "@value":"jt"
          },
          {
            "@name":"ambari_tasktracker_principal",
            "@value":"tt"
          },
          {
            "@name":"ambari_hbasemaster_principal",
            "@value":"hm"
          },
          {
            "@name":"ambari_regionserver_principal",
            "@value":"rs"
          },
          {
            "@name":"ambari_hcat_principal",
            "@value":"hcat"
          },
          {
            "@name":"ambari_hdfs_user",
            "@value":"hdfs"
          },
          {
            "@name":"ambari_mapreduce_user",
            "@value":"mapred"
          },
          {
            "@name":"ambari_hbase_user",
            "@value":"hrt_hbase"
          },
          {
            "@name":"ambari_hcat_user",
            "@value":"hcat"
          },
          {
            "@name":"ambari_admin_group",
            "@value":"hadoop"
          },
          {
            "@name":"ambari_user_realm",
            "@value":"KERBEROS.EXAMPLE.COM"
          },
          {
            "@name":"ambari_service_realm",
            "@value":"<%= ambari_user_realm %>"
          },
          {
            "@name":"ambari_keytab_dir",
            "@value":"/etc/security/keytabs"
          },
          {
            "@name":"ambari_auth_to_local",
            "@value":"RULE:[1:$1@$0](.*@<%= ambari_user_realm %>)s/@.*//\nRULE:[2:$1@$0](<%= ambari_jobtracker_principal %>@<%= ambari_service_realm %>)s/.*/<%= ambari_mapreduce_user %>/\nRULE:[2:$1@$0](<%= ambari_tasktracker_principal %>@<%= ambari_service_realm %>)s/.*/<%= ambari_mapreduce_user %>/\nRULE:[2:$1@$0](<%= ambari_namenode_principal %>@<%= ambari_service_realm %>)s/.*/<%= ambari_hdfs_user %>/\nRULE:[2:$1@$0](<%= ambari_datanode_principal %>@<%= ambari_service_realm %>)s/.*/<%= ambari_hdfs_user %>/\nRULE:[2:$1@$0](<%= ambari_hbasemaster_principal %>@<%= ambari_service_realm %>)s/.*/<%= ambari_hbase_user %>/\nRULE:[2:$1@$0](<%= ambari_regionserver_principal %>@<%= ambari_service_realm %>)s/.*/<%= ambari_hbase_user %>/\nRULE:[2:$1@$0](<%= ambari_hcat_principal %>@<%= ambari_service_realm %>)s/.*/<%= ambari_hcat_user %>/"
          }
        ]
      },
      {
        "@name":"core-site.xml",
        "property":[
          {
            "@name":"fs.default.name",
            "@value":"hdfs://<%= ambari_namenode_host %>:8020"
          },
          {
            "@name":"fs.trash.interval",
            "@value":"360"
          },
          {
            "@name":"hadoop.security.authentication",
            "@value":"simple"
          },
          {
            "@name":"hadoop.security.authorization",
            "@value":"false"
          },
          {
            "@name":"hadoop.kerberos.kinit.command",
            "@value":"/usr/kerberos/bin/kinit"
          }
        ]
      },
      {
        "@name":"hdfs-site.xml",
        "property":[
          {
            "@name":"dfs.http.address",
            "@value":"<%= ambari_namenode_host %>:50070"
          },
          {
            "@name":"dfs.umaskmode",
            "@value":"077"
          },
          {
            "@name":"dfs.block.access.token.enable",
            "@value":"false"
          },
          {
            "@name":"dfs.namenode.kerberos.principal",
            "@value":"<%= ambari_namenode_principal %>/_HOST@<%= ambari_service_realm %>"
          },
          {
            "@name":"dfs.namenode.kerberos.https.principal",
            "@value":"host/_HOST@<%= ambari_service_realm %>"
          },
          {
            "@name":"dfs.secondary.namenode.kerberos.principal",
            "@value":"<%= ambari_namenode_principal %>/_HOST@<%= ambari_service_realm %>"
          },
          {
            "@name":"dfs.secondary.namenode.kerberos.https.principal",
            "@value":"host/_HOST@<%= ambari_service_realm %>"
          },
          {
            "@name":"dfs.datanode.kerberos.principal",
            "@value":"<%= ambari_datanode_principal %>/_HOST@<%= ambari_service_realm %>"
          },
          {
            "@name":"dfs.web.authentication.kerberos.principal",
            "@value":"HTTP/_HOST@<%= ambari_service_realm %>"
          },
          {
            "@name":"dfs.https.address",
            "@value":"<%= ambari_namenode_host %>:50470"
          },
          {
            "@name":"dfs.secondary.http.address",
            "@value":"<%= ambari_namenode_host %>:50090"
          },
          {
            "@name":"dfs.support.append",
            "@value":"true"
          }
        ]
      },
      {
        "@name":"hadoop-env.sh",
        "property":[
          {
            "@name":"JAVA_HOME",
            "@value":"/usr/java/latest"
          },
          {
            "@name":"HADOOP_CONF_DIR",
            "@value":"<%= ambari_role_prefix %>/etc/hadoop"
          },
          {
            "@name":"HADOOP_OPTS",
            "@value":"-Djava.net.preferIPv4Stack=true $HADOOP_OPTS"
          },
          {
            "@name":"HADOOP_CLIENT_OPTS",
            "@value":"-Xmx128m $HADOOP_CLIENT_OPTS"
          }
        ]
      }
    ]
  },
  "components":[
    {
      "@name":"common",
      "@architecture":"x86_64",
      "@version":"0.20.205.0",
      "@provider":"org.apache.hadoop",
      "definition":{
        "@provider":"org.apache.ambari",
        "@name":"hadoop-common",
        "@version":"0.1.0"
      }
    },
    {
      "@name":"hdfs",
      "@provider":"org.apache.hadoop",
      "definition":{
        "@provider":"org.apache.ambari",
        "@name":"hadoop-hdfs",
        "@version":"0.1.0"
      },
      "configuration":{
        "category":[
          {
            "@name":"core-site.xml",
            "property":[
              {
                "@name":"hadoop.security.auth_to_local",
                "@value":"<%= ambari_auth_to_local %>"
              },
              {
                "@name":"hadoop.security.groups.cache.secs",
                "@value":"14400"
              },
              {
                "@name":"hadoop.http.filter.initializers",
                "@value":"org.apache.hadoop.http.lib.StaticUserWebFilter"
              }
            ]
          },
          {
            "@name":"hdfs-site.xml",
            "property":[
              {
                "@name":"dfs.name.dir",
                "@value":"<%= ambari_role_prefix %>/hdfs/name"
              },
              {
                "@name":"dfs.data.dir",
                "@value":"<%= ambari_role_prefix %>/hdfs/data"
              },
              {
                "@name":"dfs.safemode.threshold.pct",
                "@value":"1.0f"
              },
              {
                "@name":"dfs.datanode.address",
                "@value":"0.0.0.0:50010"
              },
              {
                "@name":"dfs.datanode.http.address",
                "@value":"0.0.0.0:50075"
              },
              {
                "@name":"dfs.web.authentication.kerberos.keytab",
                "@value":"<%= ambari_keytab_dir %>/<%= ambari_namenode_principal %>.service.keytab"
              },
              {
                "@name":"dfs.namenode.keytab.file",
                "@value":"<%= ambari_keytab_dir %>/<%= ambari_namenode_principal %>.service.keytab"
              },
              {
                "@name":"dfs.secondary.namenode.keytab.file",
                "@value":"<%= ambari_keytab_dir %>/<%= ambari_namenode_principal %>.service.keytab"
              },
              {
                "@name":"dfs.datanode.keytab.file",
                "@value":"<%= ambari_keytab_dir %>/<%= ambari_datanode_principal %>.service.keytab"
              },
              {
                "@name":"dfs.secondary.https.port",
                "@value":"50490"
              },
              {
                "@name":"dfs.https.port",
                "@value":"50470"
              },
              {
                "@name":"dfs.https.address",
                "@value":"<%= ambari_namenode_host %>:50470"
              },
              {
                "@name":"dfs.datanode.data.dir.perm",
                "@value":"700"
              },
              {
                "@name":"dfs.cluster.administrators",
                "@value":"<%= ambari_hdfs_user %>"
              },
              {
                "@name":"dfs.permissions.superusergroup",
                "@value":"<%= ambari_admin_group %>"
              },
              {
                "@name":"dfs.secondary.http.address",
                "@value":"<%= ambari_namenode_host %>:50090"
              },
              {
                "@name":"dfs.hosts",
                "@value":"<%= ambari_role_prefix %>/etc/hadoop/dfs.include"
              },
              {
                "@name":"dfs.hosts.exclude",
                "@value":"<%= ambari_role_prefix %>/etc/hadoop/dfs.exclude"
              },
              {
                "@name":"dfs.webhdfs.enabled",
                "@value":"true"
              }
            ]
          },
          {
            "@name":"hadoop-env.sh",
            "property":[
              {
                "@name":"HADOOP_NAMENODE_OPTS",
                "@value":"-Dsecurity.audit.logger=INFO,DRFAS -Dhdfs.audit.logger=INFO,DRFAAUDIT"
              },
              {
                "@name":"HADOOP_SECONDARYNAMENODE_OPTS",
                "@value":"-Dsecurity.audit.logger=INFO,DRFAS -Dhdfs.audit.logger=INFO,DRFAAUDIT"
              },
              {
                "@name":"HADOOP_DATANODE_OPTS",
                "@value":"-Dsecurity.audit.logger=ERROR,DRFAS"
              },
              {
                "@name":"HADOOP_SECURE_DN_USER",
                "@value":""
              },
              {
                "@name":"HADOOP_LOG_DIR",
                "@value":"<%= ambari_role_prefix %>/logs"
              },
              {
                "@name":"HADOOP_SECURE_DN_LOG_DIR",
                "@value":"<%= ambari_role_prefix %>/logs/secure"
              },
              {
                "@name":"HADOOP_PID_DIR",
                "@value":"<%= ambari_role_prefix %>/pids"
              },
              {
                "@name":"HADOOP_SECURE_DN_PID_DIR",
                "@value":"<%= ambari_role_prefix %>/pids/secure"
              },
              {
                "@name":"HADOOP_IDENT_STRING",
                "@value":"<%= ambari_cluster_name %>"
              }
            ]
           },
          {
            "@name":"hadoop-metrics2.properties",
            "property":{
              "@name":"*.period",
              "@value":"60"
            }
          }
        ]
      }
    }
  ]
}
