<html>
  <head>
  </head>

  <body>
    <button id="THE_BUTTON">
      Submit
    </button>

    <div id="THE_DIV"></div>

    <script src="http://yui.yahooapis.com/3.4.1/build/yui/yui-min.js"></script>
    <script type="text/javascript">
      
      YUI().use("node", "io", "dump", "json", "history", "event", function (Y) { 
        
        var currentScreen = 0;

        var history = new Y.History();

        function isEmptyObject( theObject ) {

          for( var key in theObject ) {
            if( theObject.hasOwnProperty( key ) ) {
              return false;
            }
          }

          return true;
        }

        function renderDiv( screenToDisplay ) {
          /*
          var divData = history.get();

          var screenToDisplay;

          if( isEmptyObject( divData ) ) {
            Y.log("Empty object");

            screenToDisplay = currentScreen;
          }
          else {
            Y.log(Y.Lang.dump(divData));

            screenToDisplay = divData.screen;
          }
          */

          Y.one('#THE_DIV').setContent('<h1>' + screenToDisplay + '</h1>');
        }

        Y.one("#THE_BUTTON").on( "click", function(e) {
          
          Y.log("clicked");

          currentScreen++;

          /* Update THE_DIV. */
          renderDiv(currentScreen);

          history.add({'screen' : currentScreen - 1 }, {'merge' : false});
        });

        history.on('change', function(e) {

          Y.log(Y.Lang.dump(e.src));

          if ((e.src === Y.HistoryHash.SRC_HASH) || (e.src === Y.HistoryHTML5.SRC_POPSTATE)) {

            var screenToDisplay;

            var divData = history.get();

            if( isEmptyObject( divData ) ) {
              Y.log("Empty object");

              screenToDisplay = currentScreen;
            }
            else {
              Y.log(Y.Lang.dump(divData));

              screenToDisplay = divData.screen;
            }

            renderDiv(screenToDisplay);

//            for( var k in e ) {
//              if( e.hasOwnProperty(k) ) {
//                Y.log( k + '->' + Y.Lang.dump(e[k]) );
//              }
//            }
          }
        });

        /* Initial render. */
        renderDiv( currentScreen );

      });
    </script>
  </body>
</html>
