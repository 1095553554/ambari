/**
 * Sinon.JS 1.3.4, 2012/04/16
 *
 * @author Christian Johansen (christian@cjohansen.no)
 *
 * (The BSD License)
 *
 * Copyright (c) 2010-2011, Christian Johansen, christian@cjohansen.no
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 *
 *     * Redistributions of source code must retain the above copyright notice,
 *       this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright notice,
 *       this list of conditions and the following disclaimer in the documentation
 *       and/or other materials provided with the distribution.
 *     * Neither the name of Christian Johansen nor the names of his contributors
 *       may be used to endorse or promote products derived from this software
 *       without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
var sinon=function(){var m=function(b,e){function f(b){if(b){for(var g=1,e=arguments.length,d;g<e;++g)for(d in arguments[g])b[d]=arguments[g][d];return b}}var i="undefined"!=typeof document&&document.createElement("div");return f(b,{bind:function(b,g){var e="string"==typeof g?b[g]:g,d=Array.prototype.slice.call(arguments,2);return function(){var a=d.concat(Array.prototype.slice.call(arguments));return e.apply(b,a)}},create:function(){function b(){}return function(g){b.prototype=g;return new b}}(), extend:f,nextTick:function(b){if("undefined"!=typeof process&&process.nextTick)return process.nextTick(b);e(b,0)},functionName:function(b){return!b?"":b.displayName?b.displayName:b.name?b.name:(b=b.toString().match(/function\s+([^\(]+)/m))&&b[1]||""},isNode:function(b){if(!i)return!1;try{b.appendChild(i),b.removeChild(i)}catch(g){return!1}return!0},isElement:function(e){return e&&b.isNode(e)&&1===e.nodeType}})}(m||{},setTimeout);"object"==typeof module&&"function"==typeof require&&(module.exports= m,m.eventEmitter=require("./buster-event-emitter"),Object.defineProperty(m,"defineVersionGetter",{get:function(){return require("./define-version-getter")}}));"undefined"===typeof m&&(m={});"object"===typeof module&&"function"===typeof require&&(m=require("buster-core"));m.format=m.format||{};m.format.excludeConstructors=["Object",/^.$/];m.format.quoteStrings=!0;m.format.ascii=function(){function b(b,e){if(typeof b!="object")return false;for(var h=0,g=e.length;h<g;++h)if(e[h]===b)return true;return false} function e(f,i,h){if(typeof f=="string"){h=typeof this.quoteStrings!="boolean"||this.quoteStrings;return i||h?'"'+f+'"':f}if(typeof f=="function"&&!(f instanceof RegExp))return e.func(f);i=i||[];return b(f,i)?"[Circular]":Object.prototype.toString.call(f)=="[object Array]"?e.array.call(this,f):!f?""+f:m.isElement(f)?e.element(f):typeof f.toString=="function"&&f.toString!==Object.prototype.toString?f.toString():e.object.call(this,f,i,h)}e.func=function(b){return"function "+m.functionName(b)+"() {}"}; e.array=function(b,i){i=i||[];i.push(b);for(var h=[],g=0,k=b.length;g<k;++g)h.push(e.call(this,b[g],i));return"["+h.join(", ")+"]"};e.object=function(f,i,h){i=i||[];i.push(f);var h=h||0,g=[],k,d=Object.keys&&Object.keys(f)||[];if(d.length==0)for(var a in f)f.hasOwnProperty(a)&&d.push(a);k=d.sort();var c,l,d="";a=3;for(var n=0,o=h;n<o;++n)d=d+" ";n=0;for(o=k.length;n<o;++n){c=k[n];l=f[c];l=b(l,i)?"[Circular]":e.call(this,l,i,h+2);l=(/\s/.test(c)?'"'+c+'"':c)+": "+l;a=a+l.length;g.push(l)}f=(f=e.constructorName.call(this, f))?"["+f+"] ":"";return a+h>80?f+"{\n "+d+g.join(",\n "+d)+"\n"+d+"}":f+"{ "+g.join(", ")+" }"};e.element=function(b){for(var e=b.tagName.toLowerCase(),h=b.attributes,g,k=[],d,a=0,c=h.length;a<c;++a){g=h.item(a);d=g.nodeName.toLowerCase().replace("html:","");d=="contenteditable"&&g.nodeValue=="inherit"||g.nodeValue&&k.push(d+'="'+g.nodeValue+'"')}h="<"+e+(k.length>0?" ":"");b=b.innerHTML;b.length>20&&(b=b.substr(0,20)+"[...]");return(h+k.join(" ")+">"+b+"</"+e+">").replace(/ contentEditable="inherit"/, "")};e.constructorName=function(b){for(var b=m.functionName(b&&b.constructor),e=this.excludeConstructors||m.format.excludeConstructors||[],h=0,g=e.length;h<g;++h)if(typeof e[h]=="string"&&e[h]==b||e[h].test&&e[h].test(b))return"";return b};return e}();"undefined"!=typeof module&&(module.exports=m.format);var j=function(b){function e(c){var a=false;try{c.appendChild(i);a=i.parentNode==c}catch(d){return false}finally{try{c.removeChild(i)}catch(b){}}return a}function f(c,a){for(var d in a)h.call(c,d)|| (c[d]=a[d])}var i=typeof document!="undefined"&&document.createElement("div"),h=Object.prototype.hasOwnProperty,g={wrapMethod:function(c,a,d){if(!c)throw new TypeError("Should wrap property of object");if(typeof d!="function")throw new TypeError("Method wrapper should be function");var b=c[a];if(!b||!b.constructor||!b.call||!b.apply)throw new TypeError("Attempted to wrap "+typeof b+" property "+a+" as function");if(b.restore&&b.restore.sinon)throw new TypeError("Attempted to wrap "+a+" which is already wrapped"); if(b.calledBefore)throw new TypeError("Attempted to wrap "+a+" which is already "+(b.returns?"stubbed":"spied on"));var l=h.call(c,a);c[a]=d;d.displayName=a;d.restore=function(){l?c[a]=b:delete c[a]};d.restore.sinon=true;f(d,b);return d},extend:function(c){for(var a=1,d=arguments.length;a<d;a=a+1)for(var b in arguments[a]){arguments[a].hasOwnProperty(b)&&(c[b]=arguments[a][b]);if(arguments[a].hasOwnProperty("toString")&&arguments[a].toString!=c.toString)c.toString=arguments[a].toString}return c}, create:function(c){var a=function(){};a.prototype=c;return new a},deepEqual:function o(c,a){if(typeof c!="object"||typeof a!="object"||i&&c&&c.nodeType===1&&e(c)||i&&a&&a.nodeType===1&&e(a))return c===a;if(c===a)return true;var d=Object.prototype.toString.call(c);if(d!=Object.prototype.toString.call(a))return false;if(d=="[object Array]"){if(c.length!==a.length)return false;for(var b=0,d=c.length;b<d;b=b+1)if(!o(c[b],a[b]))return false;return true}var l=d=0;for(b in c){d=d+1;if(!o(c[b],a[b]))return false}for(b in a)l= l+1;return d!=l?false:true},functionName:function(c){var a=c.displayName||c.name;if(!a)a=(c=c.toString().match(/function ([^\s\(]+)/))&&c[1];return a},functionToString:function(){if(this.getCall&&this.callCount)for(var c,a,d=this.callCount;d--;){c=this.getCall(d).thisValue;for(a in c)if(c[a]===this)return a}return this.displayName||"sinon fake"},getConfig:function(c){var a={},c=c||{},d=g.defaultConfig,b;for(b in d)d.hasOwnProperty(b)&&(a[b]=c.hasOwnProperty(b)?c[b]:d[b]);return a},format:function(c){return""+ c},defaultConfig:{injectIntoThis:true,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:true,useFakeServer:true},timesInWords:function(c){return c==1&&"once"||c==2&&"twice"||c==3&&"thrice"||(c||0)+" times"},calledInOrder:function(c){for(var a=1,d=c.length;a<d;a++)if(!c[a-1].calledBefore(c[a]))return false;return true},orderByFirstCall:function(c){return c.sort(function(c,a){var d=c.getCall(0),b=a.getCall(0);return(d&&d.callId||-1)<(b&&b.callId||-1)?-1:1})}, log:function(){},logError:function(c,a){var d=c+" threw exception: ";g.log(d+"["+a.name+"] "+a.message);a.stack&&g.log(a.stack);setTimeout(function(){a.message=d+a.message;throw a;},0)}},k=typeof module=="object"&&typeof require=="function";if(k){try{b={format:require("buster-format")}}catch(d){}module.exports=g;module.exports.spy=require("./sinon/spy");module.exports.stub=require("./sinon/stub");module.exports.mock=require("./sinon/mock");module.exports.collection=require("./sinon/collection");module.exports.assert= require("./sinon/assert");module.exports.sandbox=require("./sinon/sandbox");module.exports.test=require("./sinon/test");module.exports.testCase=require("./sinon/test_case");module.exports.assert=require("./sinon/assert")}if(b){var a=g.create(b.format);a.quoteStrings=false;g.format=function(){return a.ascii.apply(a,arguments)}}else if(k)try{var c=require("util");g.format=function(a){return typeof a=="object"?c.inspect(a):a}}catch(l){}return g}("object"==typeof m&&m);(function(b){function e(d,a){return!a&& typeof d=="function"?e.create(d):!d||!a?e.create(function(){}):b.wrapMethod(d,a,e.create(d[a]))}var f=typeof module=="object"&&typeof require=="function",i,h=0,g=[].push,k=Array.prototype.slice;!b&&f&&(b=require("../sinon"));if(b){b.extend(e,function(){function d(c,a,d,b,l){c[a]=function(){if(!this.called)return l?l.apply(this,arguments):false;for(var c,e=0,g=0,n=this.callCount;g<n;g=g+1){c=this.getCall(g);if(c[b||a].apply(c,arguments)){e=e+1;if(d)return true}}return e===this.callCount}}function a(c, a,d){if(c)for(var b=0,l=c.length;b<l;b++)if(c[b].matches(a,d))return c[b]}function c(){this.called=true;this.callCount=this.callCount+1;this.calledOnce=this.callCount==1;this.calledTwice=this.callCount==2;this.calledThrice=this.callCount==3}function l(){this.firstCall=this.getCall(0);this.secondCall=this.getCall(1);this.thirdCall=this.getCall(2);this.lastCall=this.getCall(this.callCount-1)}var n=0,f={reset:function(){this.calledThrice=this.calledTwice=this.calledOnce=this.called=false;this.callCount= 0;this.lastCall=this.thirdCall=this.secondCall=this.firstCall=null;this.args=[];this.returnValues=[];this.thisValues=[];this.exceptions=[];this.callIds=[]},create:function(c){function a(){return a.invoke(c,this,k.call(arguments))}var d;typeof c!="function"?c=function(){}:d=b.functionName(c);b.extend(a,e);delete a.create;b.extend(a,c);a.reset();a.prototype=c.prototype;a.displayName=d||"spy";a.toString=b.functionToString;a._create=b.spy.create;a.id="spy#"+n++;return a},invoke:function(d,b,e){var n= a(this.fakes,e),k;c.call(this);g.call(this.thisValues,b);g.call(this.args,e);g.call(this.callIds,h++);try{k=n?n.invoke(d,b,e):(this.func||d).apply(b,e)}catch(f){g.call(this.returnValues,void 0);throw f;}finally{g.call(this.exceptions,void 0)}g.call(this.returnValues,k);l.call(this);return k},getCall:function(c){return c<0||c>=this.callCount?null:i.create(this,this.thisValues[c],this.args[c],this.returnValues[c],this.exceptions[c],this.callIds[c])},calledBefore:function(c){return!this.called?false: !c.called?true:this.callIds[0]<c.callIds[c.callIds.length-1]},calledAfter:function(c){return!this.called||!c.called?false:this.callIds[this.callCount-1]>c.callIds[c.callCount-1]},withArgs:function(){var d=k.call(arguments);if(this.fakes){var b=a(this.fakes,d,true);if(b)return b}else this.fakes=[];var e=this,b=this._create();b.matchingAguments=d;g.call(this.fakes,b);b.withArgs=function(){return e.withArgs.apply(e,arguments)};for(d=0;d<this.args.length;d++)if(b.matches(this.args[d])){c.call(b);g.call(b.thisValues, this.thisValues[d]);g.call(b.args,this.args[d]);g.call(b.returnValues,this.returnValues[d]);g.call(b.exceptions,this.exceptions[d]);g.call(b.callIds,this.callIds[d])}l.call(b);return b},matches:function(c,a){var d=this.matchingAguments;if(d.length<=c.length&&b.deepEqual(d,c.slice(0,d.length)))return!a||d.length==c.length},printf:function(c){var a=this,d=k.call(arguments,1),l;return(c||"").replace(/%(.)/g,function(c,e){l=f.formatters[e];return typeof l=="function"?l.call(null,a,d):!isNaN(parseInt(e), 10)?b.format(d[e-1]):"%"+e})}};d(f,"calledOn",true);d(f,"alwaysCalledOn",false,"calledOn");d(f,"calledWith",true);d(f,"alwaysCalledWith",false,"calledWith");d(f,"calledWithExactly",true);d(f,"alwaysCalledWithExactly",false,"calledWithExactly");d(f,"neverCalledWith",false,"notCalledWith",function(){return true});d(f,"threw",true);d(f,"alwaysThrew",false,"threw");d(f,"returned",true);d(f,"alwaysReturned",false,"returned");d(f,"calledWithNew",true);d(f,"alwaysCalledWithNew",false,"calledWithNew");d(f, "callArg",false,"callArgWith",function(){throw Error(this.toString()+" cannot call arg since it was not yet invoked.");});f.callArgWith=f.callArg;d(f,"yield",false,"yield",function(){throw Error(this.toString()+" cannot yield since it was not yet invoked.");});f.invokeCallback=f.yield;d(f,"yieldTo",false,"yieldTo",function(c){throw Error(this.toString()+" cannot yield to '"+c+"' since it was not yet invoked.");});f.formatters={c:function(c){return b.timesInWords(c.callCount)},n:function(c){return c.toString()}, C:function(c){for(var a=[],d=0,b=c.callCount;d<b;++d)g.call(a," "+c.getCall(d).toString());return a.length>0?"\n"+a.join("\n"):""},t:function(c){for(var a=[],d=0,l=c.callCount;d<l;++d)g.call(a,b.format(c.thisValues[d]));return a.join(", ")},"*":function(c,a){return a.join(", ")}};return f}());i=function(){function d(a,c,d){a=b.functionName(a)+c;d.length&&(a=a+(" Received ["+k.call(d).join(", ")+"]"));throw Error(a);}return{create:function(a,c,d,e,g,k){var f=b.create(i);delete f.create;f.proxy= a;f.thisValue=c;f.args=d;f.returnValue=e;f.exception=g;f.callId=typeof k=="number"&&k||h++;return f},calledOn:function(a){return this.thisValue===a},calledWith:function(){for(var a=0,c=arguments.length;a<c;a=a+1)if(!b.deepEqual(arguments[a],this.args[a]))return false;return true},calledWithExactly:function(){return arguments.length==this.args.length&&this.calledWith.apply(this,arguments)},notCalledWith:function(){for(var a=0,c=arguments.length;a<c;a=a+1)if(!b.deepEqual(arguments[a],this.args[a]))return true; return false},returned:function(a){return this.returnValue===a},threw:function(a){return typeof a=="undefined"||!this.exception?!!this.exception:typeof a=="string"?this.exception.name==a:this.exception===a},calledWithNew:function(){return this.thisValue instanceof this.proxy},calledBefore:function(a){return this.callId<a.callId},calledAfter:function(a){return this.callId>a.callId},callArg:function(a){this.args[a]()},callArgWith:function(a){var c=k.call(arguments,1);this.args[a].apply(null,c)},yield:function(){for(var a= this.args,c=0,b=a.length;c<b;++c)if(typeof a[c]==="function"){a[c].apply(null,k.call(arguments));return}d(this.proxy," cannot yield since no callback was passed.",a)},yieldTo:function(a){for(var c=this.args,b=0,e=c.length;b<e;++b)if(c[b]&&typeof c[b][a]==="function"){c[b][a].apply(null,k.call(arguments,1));return}d(this.proxy," cannot yield to '"+a+"' since no callback was passed.",c)},toString:function(){for(var a=this.proxy.toString()+"(",c=[],d=0,e=this.args.length;d<e;++d)g.call(c,b.format(this.args[d])); a=a+c.join(", ")+")";typeof this.returnValue!="undefined"&&(a=a+(" => "+b.format(this.returnValue)));if(this.exception){a=a+(" !"+this.exception.name);this.exception.message&&(a=a+("("+this.exception.message+")"))}return a}}}();e.spyCall=i;b.spyCall=i;f?module.exports=e:b.spy=e}})("object"==typeof j&&j||null);(function(b){function e(d,a,c){if(c&&typeof c!="function")throw new TypeError("Custom stub should be function");c=c?b.spy&&b.spy.create?b.spy.create(c):c:e.create();if(!d&&!a)return b.stub.create(); if(!a&&d&&typeof d=="object"){for(var l in d)typeof d[l]==="function"&&e(d,l);return d}return b.wrapMethod(d,a,c)}function f(d,a){if(d.callArgAt<0){for(var c=0,b=a.length;c<b;++c){if(!d.callArgProp&&typeof a[c]=="function")return a[c];if(d.callArgProp&&a[c]&&typeof a[c][d.callArgProp]=="function")return a[c][d.callArgProp]}return null}return a[d.callArgAt]}function i(d,a,c){if(d.callArgAt<0){d=d.callArgProp?b.functionName(d)+" expected to yield to '"+d.callArgProp+"', but no object with such a property was passed.": b.functionName(d)+" expected to yield, but no callback was passed.";c.length>0&&(d=d+(" Received ["+g.call(c,", ")+"]"));return d}return"argument at index "+d.callArgAt+" is not a function: "+a}var h=typeof module=="object"&&typeof require=="function";!b&&h&&(b=require("../sinon"));if(b){var g=Array.prototype.join,k=0;b.extend(e,function(){function d(c,a){if(typeof c=="string"){this.exception=Error(a||"");this.exception.name=c}else this.exception=c?c:Error("Error");return this}var a=Array.prototype.slice; return{create:function(){var c=function(){if(c.exception)throw c.exception;if(typeof c.returnArgAt=="number")return arguments[c.returnArgAt];var a=c,d=arguments;if(typeof a.callArgAt=="number"){var b=f(a,d);if(typeof b!="function")throw new TypeError(i(a,b,d));b.apply(a.callbackContext,a.callbackArguments)}return c.returnValue};c.id="stub#"+k++;var a=c,c=b.spy.create(c);c.func=a;b.extend(c,e);c._create=b.stub.create;c.displayName="stub";c.toString=b.functionToString;return c},returns:function(c){this.returnValue= c;return this},returnsArg:function(c){if(typeof c!="number")throw new TypeError("argument index is not number");this.returnArgAt=c;return this},"throws":d,throwsException:d,callsArg:function(c){if(typeof c!="number")throw new TypeError("argument index is not number");this.callArgAt=c;this.callbackArguments=[];return this},callsArgOn:function(c,a){if(typeof c!="number")throw new TypeError("argument index is not number");if(typeof a!="object")throw new TypeError("argument context is not an object"); this.callArgAt=c;this.callbackArguments=[];this.callbackContext=a;return this},callsArgWith:function(c){if(typeof c!="number")throw new TypeError("argument index is not number");this.callArgAt=c;this.callbackArguments=a.call(arguments,1);return this},callsArgOnWith:function(c,d){if(typeof c!="number")throw new TypeError("argument index is not number");if(typeof d!="object")throw new TypeError("argument context is not an object");this.callArgAt=c;this.callbackArguments=a.call(arguments,2);this.callbackContext= d;return this},yields:function(){this.callArgAt=-1;this.callbackArguments=a.call(arguments,0);return this},yieldsOn:function(c){if(typeof c!="object")throw new TypeError("argument context is not an object");this.callArgAt=-1;this.callbackArguments=a.call(arguments,1);this.callbackContext=c;return this},yieldsTo:function(c){this.callArgAt=-1;this.callArgProp=c;this.callbackArguments=a.call(arguments,1);return this},yieldsToOn:function(c,d){if(typeof d!="object")throw new TypeError("argument context is not an object"); this.callArgAt=-1;this.callArgProp=c;this.callbackArguments=a.call(arguments,2);this.callbackContext=d;return this}}}());h?module.exports=e:b.stub=e}})("object"==typeof j&&j||null);(function(b){function e(g){return!g?b.expectation.create("Anonymous mock"):e.create(g)}var f=typeof module=="object"&&typeof require=="function",i=[].push;!b&&f&&(b=require("../sinon"));if(b){b.mock=e;b.extend(e,function(){function g(b,d){if(b)for(var a=0,c=b.length;a<c;a=a+1)d(b[a])}return{create:function(g){if(!g)throw new TypeError("object is null"); var d=b.extend({},e);d.object=g;delete d.create;return d},expects:function(e){if(!e)throw new TypeError("method is falsy");if(!this.expectations){this.expectations={};this.proxies=[]}if(!this.expectations[e]){this.expectations[e]=[];var d=this;b.wrapMethod(this.object,e,function(){return d.invokeMethod(e,this,arguments)});i.call(this.proxies,e)}var a=b.expectation.create(e);i.call(this.expectations[e],a);return a},restore:function(){var b=this.object;g(this.proxies,function(d){typeof b[d].restore== "function"&&b[d].restore()})},verify:function(){var e=this.expectations||{},d=[],a=[];g(this.proxies,function(c){g(e[c],function(c){c.met()?i.call(a,c.toString()):i.call(d,c.toString())})});this.restore();d.length>0&&b.expectation.fail(d.concat(a).join("\n"));return true},invokeMethod:function(e,d,a){for(var c=this.expectations&&this.expectations[e],g=c&&c.length||0,f=0;f<g;f=f+1)if(!c[f].met()&&c[f].allowsCall(d,a))return c[f].apply(d,a);d=[];for(f=0;f<g;f=f+1)i.call(d," "+c[f].toString());d.unshift("Unexpected call: "+ b.spyCall.toString.call({proxy:e,args:a}));b.expectation.fail(d.join("\n"))}}}());var h=b.timesInWords;b.expectation=function(){var e=Array.prototype.slice,f=b.spy.invoke;return{minCalls:1,maxCalls:1,create:function(d){var a=b.extend(b.stub.create(),b.expectation);delete a.create;a.method=d;return a},invoke:function(d,a,c){this.verifyCallAllowed(a,c);return f.apply(this,arguments)},atLeast:function(d){if(typeof d!="number")throw new TypeError("'"+d+"' is not number");if(!this.limitsSet){this.maxCalls= null;this.limitsSet=true}this.minCalls=d;return this},atMost:function(d){if(typeof d!="number")throw new TypeError("'"+d+"' is not number");if(!this.limitsSet){this.minCalls=null;this.limitsSet=true}this.maxCalls=d;return this},never:function(){return this.exactly(0)},once:function(){return this.exactly(1)},twice:function(){return this.exactly(2)},thrice:function(){return this.exactly(3)},exactly:function(d){if(typeof d!="number")throw new TypeError("'"+d+"' is not a number");this.atLeast(d);return this.atMost(d)}, met:function(){var d;if(d=!this.failed)d=typeof this.minCalls!="number"||this.callCount>=this.minCalls;return d},verifyCallAllowed:function(d,a){var c;c=typeof this.maxCalls!="number"?false:this.callCount==this.maxCalls;if(c){this.failed=true;b.expectation.fail(this.method+" already called "+h(this.maxCalls))}"expectedThis"in this&&this.expectedThis!==d&&b.expectation.fail(this.method+" called with "+d+" as thisValue, expected "+this.expectedThis);if("expectedArguments"in this){(!a||a.length===0)&& b.expectation.fail(this.method+" received no arguments, expected "+this.expectedArguments.join());a.length<this.expectedArguments.length&&b.expectation.fail(this.method+" received too few arguments ("+a.join()+"), expected "+this.expectedArguments.join());this.expectsExactArgCount&&a.length!=this.expectedArguments.length&&b.expectation.fail(this.method+" received too many arguments ("+a.join()+"), expected "+this.expectedArguments.join());c=0;for(var e=this.expectedArguments.length;c<e;c=c+1)b.deepEqual(this.expectedArguments[c], a[c])||b.expectation.fail(this.method+" received wrong arguments ("+a.join()+"), expected "+this.expectedArguments.join())}},allowsCall:function(d,a){if(this.met()||"expectedThis"in this&&this.expectedThis!==d)return false;if(!("expectedArguments"in this))return true;a=a||[];if(a.length<this.expectedArguments.length||this.expectsExactArgCount&&a.length!=this.expectedArguments.length)return false;for(var c=0,e=this.expectedArguments.length;c<e;c=c+1)if(!b.deepEqual(this.expectedArguments[c],a[c]))return false; return true},withArgs:function(){this.expectedArguments=e.call(arguments);return this},withExactArgs:function(){this.withArgs.apply(this,arguments);this.expectsExactArgCount=true;return this},on:function(d){this.expectedThis=d;return this},toString:function(){var d=(this.expectedArguments||[]).slice();this.expectsExactArgCount||i.call(d,"[...]");var d=b.spyCall.toString.call({proxy:this.method,args:d}).replace(", [...","[, ...")+" ",a;a=this.minCalls;var c=this.maxCalls;if(typeof a=="number"&&typeof c== "number"){var e=h(a);a!=c&&(e="at least "+e+" and at most "+h(c));a=e}else a=typeof a=="number"?"at least "+h(a):"at most "+h(c);d=d+a;if(this.met())return"Expectation met: "+d;d="Expected "+d+" (";a=this.callCount;a=a==0?"never called":"called "+h(a);return d+a+")"},verify:function(){this.met()||b.expectation.fail(this.toString());return true},fail:function(d){d=Error(d);d.name="ExpectationError";throw d;}}}();f?module.exports=e:b.mock=e}})("object"==typeof j&&j||null);(function(b){function e(b){if(!b.fakes)b.fakes= [];return b.fakes}function f(b,d){for(var a=e(b),c=0,g=a.length;c<g;c=c+1)if(typeof a[c][d]=="function")a[c][d]()}var i=typeof module=="object"&&typeof require=="function",h=[].push;!b&&i&&(b=require("../sinon"));if(b){var g={verify:function(){f(this,"verify")},restore:function(){f(this,"restore");for(var b=e(this);0<b.length;)b.splice(0,1)},verifyAndRestore:function(){var b;try{this.verify()}catch(d){b=d}this.restore();if(b)throw b;},add:function(b){h.call(e(this),b);return b},spy:function(){return this.add(b.spy.apply(b, arguments))},stub:function(e,d,a){if(d){var c=e[d];if(typeof c!="function"){if(!e.hasOwnProperty(d))throw new TypeError("Cannot stub non-existent own property "+d);e[d]=a;return this.add({restore:function(){e[d]=c}})}}return this.add(b.stub.apply(b,arguments))},mock:function(){return this.add(b.mock.apply(b,arguments))},inject:function(b){var d=this;b.spy=function(){return d.spy.apply(d,arguments)};b.stub=function(){return d.stub.apply(d,arguments)};b.mock=function(){return d.mock.apply(d,arguments)}; return b}};i?module.exports=g:b.collection=g}})("object"==typeof j&&j||null);"undefined"==typeof j&&(j={});(function(b){function e(a,c){if(a.length===0)throw Error("Function requires at least 1 parameter");var b=k++,d=a[1]||0;if(!this.timeouts)this.timeouts={};this.timeouts[b]={id:b,func:a[0],callAt:this.now+d};if(c===true)this.timeouts[b].interval=d;return b}function f(a){if(Object.create)a=Object.create(a);else{var c=function(){};c.prototype=a;a=new c}return a.Date.clock=a}function i(a,c){c.now? a.now=function(){return a.clock.now}:delete a.now;c.toSource?a.toSource=function(){return c.toSource()}:delete a.toSource;a.toString=function(){return c.toString()};a.prototype=c.prototype;a.parse=c.parse;a.UTC=c.UTC;a.prototype.toUTCString=c.prototype.toUTCString;return a}function h(){for(var a,c=0,d=this.methods.length;c<d;c++){a=this.methods[c];b[a]=this["_"+a]}}function g(a,c){c["_"+a]=b[a];if(a=="Date"){var d=i(c[a],b[a]);b[a]=d}else{b[a]=function(){return c[a].apply(c,arguments)};for(d in c[a])c[a].hasOwnProperty(d)&& (b[a][d]=c[a][d])}b[a].clock=c}var k=1;j.clock={now:0,create:function(a){var c=f(this);if(typeof a=="number")c.now=a;if(a&&typeof a=="object")throw new TypeError("now should be milliseconds since UNIX epoch");return c},setTimeout:function(a,c){return e.call(this,arguments,false)},clearTimeout:function(a){if(!this.timeouts)this.timeouts=[];a in this.timeouts&&delete this.timeouts[a]},setInterval:function(a,c){return e.call(this,arguments,true)},clearInterval:function(a){this.clearTimeout(a)},tick:function(a){var c; if(typeof a=="number")c=a;else if(a){c=a.split(":");var d=c.length,b=d,e=0,g;if(d>3||!/^(\d\d:){0,2}\d\d?$/.test(a))throw Error("tick only understands numbers and 'h:m:s'");for(;b--;){g=parseInt(c[b],10);if(g>=60)throw Error("Invalid time "+a);e=e+g*Math.pow(60,d-b-1)}c=e*1E3}else c=0;a=this.now;c=this.now+c;for(var d=this.now,b=this.firstTimerInRange(a,c),f;b&&a<=c;){if(this.timeouts[b.id]){a=this.now=b.callAt;try{this.callTimer(b)}catch(h){f=f||h}}b=this.firstTimerInRange(d,c);d=a}this.now=c;if(f)throw f; },firstTimerInRange:function(a,c){var d,b,e;for(e in this.timeouts)if(this.timeouts.hasOwnProperty(e)&&!(this.timeouts[e].callAt<a||this.timeouts[e].callAt>c))if(!b||this.timeouts[e].callAt<b){b=this.timeouts[e].callAt;d={func:this.timeouts[e].func,callAt:this.timeouts[e].callAt,interval:this.timeouts[e].interval,id:this.timeouts[e].id}}return d||null},callTimer:function(a){try{typeof a.func=="function"?a.func.call(null):eval(a.func)}catch(c){var d=c}if(this.timeouts[a.id])typeof a.interval=="number"? this.timeouts[a.id].callAt=this.timeouts[a.id].callAt+a.interval:delete this.timeouts[a.id];if(d)throw d;},reset:function(){this.timeouts={}},Date:function(){function a(d,b,e,g,f,h,i){switch(arguments.length){case 0:return new c(a.clock.now);case 1:return new c(d);case 2:return new c(d,b);case 3:return new c(d,b,e);case 4:return new c(d,b,e,g);case 5:return new c(d,b,e,g,f);case 6:return new c(d,b,e,g,f,h);default:return new c(d,b,e,g,f,h,i)}}var c=Date;return i(a,c)}()};var d=["Date","setTimeout", "setInterval","clearTimeout","clearInterval"];j.useFakeTimers=function(a){var c=j.clock.create(a);c.restore=h;c.methods=Array.prototype.slice.call(arguments,typeof a=="number"?1:0);if(c.methods.length===0)c.methods=d;for(var b=0,e=c.methods.length;b<e;b++)g(c.methods[b],c);return c}})("undefined"!=typeof global&&"function"!==typeof global?global:this);j.timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval,Date:Date};"object"==typeof module&&"function"== typeof require&&(module.exports=j);"undefined"==typeof j&&(this.sinon={});(function(){var b=[].push;j.Event=function(b,f,i){this.initEvent(b,f,i)};j.Event.prototype={initEvent:function(b,f,i){this.type=b;this.bubbles=f;this.cancelable=i},stopPropagation:function(){},preventDefault:function(){this.defaultPrevented=true}};j.EventTarget={addEventListener:function(e,f){this.eventListeners=this.eventListeners||{};this.eventListeners[e]=this.eventListeners[e]||[];b.call(this.eventListeners[e],f)},removeEventListener:function(b, f){for(var i=this.eventListeners&&this.eventListeners[b]||[],h=0,g=i.length;h<g;++h)if(i[h]==f)return i.splice(h,1)},dispatchEvent:function(b){for(var f=b.type,f=this.eventListeners&&this.eventListeners[f]||[],i=0;i<f.length;i++)typeof f[i]=="function"?f[i].call(this,b):f[i].handleEvent(b);return!!b.defaultPrevented}}})();"undefined"==typeof j&&(this.sinon={});j.xhr={XMLHttpRequest:this.XMLHttpRequest};(function(b){function e(){this.readyState=e.UNSENT;this.requestHeaders={};this.requestBody=null; this.status=0;this.statusText="";if(typeof e.onCreate=="function")e.onCreate(this)}function f(c){if(c.readyState!==e.OPENED)throw Error("INVALID_STATE_ERR");if(c.sendFlag)throw Error("INVALID_STATE_ERR");}function i(c,a){if(c)for(var b=0,d=c.length;b<d;b=b+1)a(c[b])}function h(c,a){for(var b=0;b<c.length;b++)if(a(c[b])===true)return true;return false}var g=j.xhr;g.GlobalXMLHttpRequest=b.XMLHttpRequest;g.GlobalActiveXObject=b.ActiveXObject;g.supportsActiveX=typeof g.GlobalActiveXObject!="undefined"; g.supportsXHR=typeof g.GlobalXMLHttpRequest!="undefined";g.workingXHR=g.supportsXHR?g.GlobalXMLHttpRequest:g.supportsActiveX?function(){return new g.GlobalActiveXObject("MSXML2.XMLHTTP.3.0")}:false;var k={"Accept-Charset":true,"Accept-Encoding":true,Connection:true,"Content-Length":true,Cookie:true,Cookie2:true,"Content-Transfer-Encoding":true,Date:true,Expect:true,Host:true,"Keep-Alive":true,Referer:true,TE:true,Trailer:true,"Transfer-Encoding":true,Upgrade:true,"User-Agent":true,Via:true},d=function(c, a,b){switch(b.length){case 0:return c[a]();case 1:return c[a](b[0]);case 2:return c[a](b[0],b[1]);case 3:return c[a](b[0],b[1],b[2]);case 4:return c[a](b[0],b[1],b[2],b[3]);case 5:return c[a](b[0],b[1],b[2],b[3],b[4])}};e.filters=[];e.addFilter=function(c){this.filters.push(c)};var a=/MSIE 6/;e.defake=function(c,b){var g=new j.xhr.workingXHR;i(["open","setRequestHeader","send","abort","getResponseHeader","getAllResponseHeaders","addEventListener","overrideMimeType","removeEventListener"],function(a){c[a]= function(){return d(g,a,arguments)}});var f=function(b){i(b,function(b){try{c[b]=g[b]}catch(d){if(!a.test(navigator.userAgent))throw d;}})},h=function(){c.readyState=g.readyState;g.readyState>=e.HEADERS_RECEIVED&&f(["status","statusText"]);g.readyState>=e.LOADING&&f(["responseText"]);g.readyState===e.DONE&&f(["responseXML"]);c.onreadystatechange&&c.onreadystatechange.call(c)};if(g.addEventListener){for(var k in c.eventListeners)c.eventListeners.hasOwnProperty(k)&&i(c.eventListeners[k],function(c){g.addEventListener(k, c)});g.addEventListener("readystatechange",h)}else g.onreadystatechange=h;d(g,"open",b)};e.useFilters=false;j.extend(e.prototype,j.EventTarget,{async:true,open:function(c,a,b,d,g){this.method=c;this.url=a;this.async=typeof b=="boolean"?b:true;this.username=d;this.password=g;this.responseXML=this.responseText=null;this.requestHeaders={};this.sendFlag=false;if(j.FakeXMLHttpRequest.useFilters===true){var f=arguments;if(h(e.filters,function(c){return c.apply(this,f)}))return j.FakeXMLHttpRequest.defake(this, arguments)}this.readyStateChange(e.OPENED)},readyStateChange:function(c){this.readyState=c;if(typeof this.onreadystatechange=="function")try{this.onreadystatechange()}catch(a){j.logError("Fake XHR onreadystatechange handler",a)}this.dispatchEvent(new j.Event("readystatechange"))},setRequestHeader:function(c,a){f(this);if(k[c]||/^(Sec-|Proxy-)/.test(c))throw Error('Refused to set unsafe header "'+c+'"');this.requestHeaders[c]=this.requestHeaders[c]?this.requestHeaders[c]+(","+a):a},setResponseHeaders:function(c){this.responseHeaders= {};for(var a in c)c.hasOwnProperty(a)&&(this.responseHeaders[a]=c[a]);this.async&&this.readyStateChange(e.HEADERS_RECEIVED)},send:function(c){f(this);if(!/^(get|head)$/i.test(this.method)){this.requestHeaders["Content-Type"]=this.requestHeaders["Content-Type"]?this.requestHeaders["Content-Type"].split(";")[0]+";charset=utf-8":"text/plain;charset=utf-8";this.requestBody=c}this.errorFlag=false;this.sendFlag=this.async;this.readyStateChange(e.OPENED);if(typeof this.onSend=="function")this.onSend(this)}, abort:function(){this.aborted=true;this.responseText=null;this.errorFlag=true;this.requestHeaders={};if(this.readyState>j.FakeXMLHttpRequest.UNSENT&&this.sendFlag){this.readyStateChange(j.FakeXMLHttpRequest.DONE);this.sendFlag=false}this.readyState=j.FakeXMLHttpRequest.UNSENT},getResponseHeader:function(c){if(this.readyState<e.HEADERS_RECEIVED||/^Set-Cookie2?$/i.test(c))return null;var c=c.toLowerCase(),a;for(a in this.responseHeaders)if(a.toLowerCase()==c)return this.responseHeaders[a];return null}, getAllResponseHeaders:function(){if(this.readyState<e.HEADERS_RECEIVED)return"";var c="",a;for(a in this.responseHeaders)this.responseHeaders.hasOwnProperty(a)&&!/^Set-Cookie2?$/i.test(a)&&(c=c+(a+": "+this.responseHeaders[a]+"\r\n"));return c},setResponseBody:function(c){if(this.readyState==e.DONE)throw Error("Request done");if(this.async&&this.readyState!=e.HEADERS_RECEIVED)throw Error("No headers received");if(typeof c!="string"){c=Error("Attempted to respond to fake XMLHttpRequest with "+c+", which is not a string."); c.name="InvalidBodyException";throw c;}var a=this.chunkSize||10,b=0;this.responseText="";do{this.async&&this.readyStateChange(e.LOADING);this.responseText=this.responseText+c.substring(b,b+a);b=b+a}while(b<c.length);c=this.getResponseHeader("Content-Type");if(this.responseText&&(!c||/(text\/xml)|(application\/xml)|(\+xml)/.test(c)))try{this.responseXML=e.parseXML(this.responseText)}catch(d){}this.async?this.readyStateChange(e.DONE):this.readyState=e.DONE},respond:function(c,a,b){this.setResponseHeaders(a|| {});this.status=typeof c=="number"?c:200;this.statusText=e.statusCodes[this.status];this.setResponseBody(b||"")}});j.extend(e,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4});e.parseXML=function(c){var a;if(typeof DOMParser!="undefined")a=(new DOMParser).parseFromString(c,"text/xml");else{a=new ActiveXObject("Microsoft.XMLDOM");a.async="false";a.loadXML(c)}return a};e.statusCodes={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information", 204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long", 415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"};j.useFakeXMLHttpRequest=function(){j.FakeXMLHttpRequest.restore=function(a){if(g.supportsXHR)b.XMLHttpRequest=g.GlobalXMLHttpRequest;if(g.supportsActiveX)b.ActiveXObject=g.GlobalActiveXObject;delete j.FakeXMLHttpRequest.restore;a!== true&&delete j.FakeXMLHttpRequest.onCreate};if(g.supportsXHR)b.XMLHttpRequest=j.FakeXMLHttpRequest;if(g.supportsActiveX)b.ActiveXObject=function(a){return a=="Microsoft.XMLHTTP"||/^Msxml2\.XMLHTTP/i.test(a)?new j.FakeXMLHttpRequest:new g.GlobalActiveXObject(a)};return j.FakeXMLHttpRequest};j.FakeXMLHttpRequest=e})(this);"object"==typeof module&&"function"==typeof require&&(module.exports=j);"undefined"==typeof j&&(j={});j.fakeServer=function(){function b(){}function e(b){var e=b;Object.prototype.toString.call(b)!= "[object Array]"&&(e=[200,{},b]);if(typeof e[2]!="string")throw new TypeError("Fake server response body should be string, but was "+typeof e[2]);return e}var f=[].push,i=window.location,h=RegExp("^"+i.protocol+"//"+i.host);return{create:function(){var e;b.prototype=this;e=new b;this.xhr=j.useFakeXMLHttpRequest();e.requests=[];this.xhr.onCreate=function(b){e.addRequest(b)};return e},addRequest:function(b){var e=this;f.call(this.requests,b);b.onSend=function(){e.handleRequest(this)};if(this.autoRespond&& !this.responding){setTimeout(function(){e.responding=false;e.respond()},this.autoRespondAfter||10);this.responding=true}},getHTTPMethod:function(b){if(this.fakeHTTPMethods&&/post/i.test(b.method)){var e=(b.requestBody||"").match(/_method=([^\b;]+)/);return e?e[1]:b.method}return b.method},handleRequest:function(b){if(b.async){if(!this.queue)this.queue=[];f.call(this.queue,b)}else this.processRequest(b)},respondWith:function(b,h,d){if(arguments.length==1&&typeof b!="function")this.response=e(b);else{if(!this.responses)this.responses= [];if(arguments.length==1){d=b;h=b=null}if(arguments.length==2){d=h;h=b;b=null}f.call(this.responses,{method:b,url:h,response:typeof d=="function"?d:e(d)})}},respond:function(){arguments.length>0&&this.respondWith.apply(this,arguments);for(var b=this.queue||[],e;e=b.shift();)this.processRequest(e)},processRequest:function(b){try{if(!b.aborted){var e=this.response||[404,{},""];if(this.responses)for(var d=0,a=this.responses.length;d<a;d++){var c;var f=this.responses[d],i=b;this.getHTTPMethod(i);var o= i.url;if(!/^https?:\/\//.test(o)||h.test(o))o=o.replace(h,"");var m=f,t=this.getHTTPMethod(i),q=o,r=m.method,u=!r||r.toLowerCase()==t.toLowerCase(),p=m.url,v=!p||p==q||typeof p.test=="function"&&p.test(q);if(u&&v)if(typeof f.response=="function"){var s=f.url,w=[i].concat(!s?[]:o.match(s).slice(1));c=f.response.apply(f,w)}else c=true;else c=false;if(c){e=this.responses[d].response;break}}b.readyState!=4&&b.respond(e[0],e[1],e[2])}}catch(x){j.logError("Fake server request processing",x)}},restore:function(){return this.xhr.restore&& this.xhr.restore.apply(this.xhr,arguments)}}}();"object"==typeof module&&"function"==typeof require&&(module.exports=j);(function(){function b(){}b.prototype=j.fakeServer;j.fakeServerWithClock=new b;j.fakeServerWithClock.addRequest=function(b){if(b.async){if(typeof setTimeout.clock=="object")this.clock=setTimeout.clock;else{this.clock=j.useFakeTimers();this.resetClock=true}if(!this.longestTimeout){var f=this.clock.setTimeout,i=this.clock.setInterval,h=this;this.clock.setTimeout=function(b,e){h.longestTimeout= Math.max(e,h.longestTimeout||0);return f.apply(this,arguments)};this.clock.setInterval=function(b,e){h.longestTimeout=Math.max(e,h.longestTimeout||0);return i.apply(this,arguments)}}}return j.fakeServer.addRequest.call(this,b)};j.fakeServerWithClock.respond=function(){var b=j.fakeServer.respond.apply(this,arguments);if(this.clock){this.clock.tick(this.longestTimeout||0);this.longestTimeout=0;if(this.resetClock){this.clock.restore();this.resetClock=false}}return b};j.fakeServerWithClock.restore=function(){this.clock&& this.clock.restore();return j.fakeServer.restore.apply(this,arguments)}})();"object"==typeof module&&"function"==typeof require&&(j=require("../sinon"),j.extend(j,require("./util/fake_timers")));(function(){var b=[].push;j.sandbox=j.extend(j.create(j.collection),{useFakeTimers:function(){this.clock=j.useFakeTimers.apply(j,arguments);return this.add(this.clock)},serverPrototype:j.fakeServer,useFakeServer:function(){var b=this.serverPrototype||j.fakeServer;if(!b||!b.create)return null;this.server=b.create(); return this.add(this.server)},inject:function(b){j.collection.inject.call(this,b);if(this.clock)b.clock=this.clock;if(this.server){b.server=this.server;b.requests=this.server.requests}return b},create:function(e){if(!e)return j.create(j.sandbox);var f=j.create(j.sandbox);if(e.useFakeServer){if(typeof e.useFakeServer=="object")f.serverPrototype=e.useFakeServer;f.useFakeServer()}e.useFakeTimers&&(typeof e.useFakeTimers=="object"?f.useFakeTimers.apply(f,e.useFakeTimers):f.useFakeTimers());f.args=f.args|| [];var i,h,g=f.inject({});if(e.properties)for(var k=0,d=e.properties.length;k<d;k++){i=e.properties[k];h=g[i]||i=="sandbox"&&f;var a=f;h&&(e.injectInto?e.injectInto[i]=h:b.call(a.args,h))}else(i=h)&&(e.injectInto?e.injectInto.sandbox=i:b.call(f.args,i));return f}});j.sandbox.useFakeXMLHttpRequest=j.sandbox.useFakeServer;if(typeof module=="object"&&typeof require=="function")module.exports=j.sandbox})();(function(b){function e(e){var f=typeof e;if(f!="function")throw new TypeError("sinon.test needs to wrap a test function, got "+ f);return function(){var f=b.getConfig(b.config);f.injectInto=f.injectIntoThis&&this||f.injectInto;var f=b.sandbox.create(f),h,d=Array.prototype.slice.call(arguments).concat(f.args);try{h=e.apply(this,d)}finally{f.verifyAndRestore()}return h}}var f=typeof module=="object"&&typeof require=="function";!b&&f&&(b=require("../sinon"));if(b){e.config={injectIntoThis:true,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:true,useFakeServer:true};f?module.exports= e:b.test=e}})("object"==typeof j&&j||null);(function(b){function e(b,e,f){return function(){e&&e.apply(this,arguments);var d,a;try{a=b.apply(this,arguments)}catch(c){d=c}f&&f.apply(this,arguments);if(d)throw d;return a}}function f(f,g){if(!f||typeof f!="object")throw new TypeError("sinon.testCase needs an object with test functions");var i=RegExp("^"+(g||"test")),d={},a,c,j,n=f.setUp,o=f.tearDown;for(a in f)if(f.hasOwnProperty(a)){c=f[a];if(!/^(setUp|tearDown)$/.test(a))if(typeof c=="function"&&i.test(a)){j= c;if(n||o)j=e(c,n,o);d[a]=b.test(j)}else d[a]=f[a]}return d}var i=typeof module=="object"&&typeof require=="function";!b&&i&&(b=require("../sinon"));if(b&&Object.prototype.hasOwnProperty)i?module.exports=f:b.testCase=f})("object"==typeof j&&j||null);(function(b,e){function f(){for(var a,c=0,b=arguments.length;c<b;++c){(a=arguments[c])||d.fail("fake is not a spy");typeof a!="function"&&d.fail(a+" is not a function");typeof a.getCall!="function"&&d.fail(a+" is not stubbed")}}function i(a,c){a=a||e; (a.fail||d.fail).call(a,c)}function h(a,c,b){if(arguments.length==2){b=c;c=a}d[a]=function(e){f(e);var g=j.call(arguments,1),h=false;(h=typeof c=="function"?!c(e):typeof e[c]=="function"?!e[c].apply(e,g):!e[c])?i(this,e.printf.apply(e,[b].concat(g))):d.pass(a)}}var g=typeof module=="object"&&typeof require=="function",j=Array.prototype.slice,d;!b&&g&&(b=require("../sinon"));if(b){d={failException:"AssertError",fail:function(a){a=Error(a);a.name=this.failException||d.failException;throw a;},pass:function(){}, callOrder:function(){f.apply(null,arguments);var a="",c="";if(b.calledInOrder(arguments))d.pass("callOrder");else{try{a=[].join.call(arguments,", ");c=b.orderByFirstCall(j.call(arguments)).join(", ")}catch(e){}i(this,"expected "+a+" to be called in order but were called as "+c)}},callCount:function(a,c){f(a);if(a.callCount!=c){var e="expected %n to be called "+b.timesInWords(c)+" but was called %c%C";i(this,a.printf(e))}else d.pass("callCount")},expose:function(a,c){if(!a)throw new TypeError("target is null or undefined"); var b=c||{},d=typeof b.prefix=="undefined"&&"assert"||b.prefix,b=typeof b.includeFail=="undefined"||!!b.includeFail,e;for(e in this)if(e!="export"&&(b||!/^(fail)/.test(e)))a[!d||/^fail/.test(e)?e:d+e.slice(0,1).toUpperCase()+e.slice(1)]=this[e];return a}};h("called","expected %n to have been called at least once but was never called");h("notCalled",function(a){return!a.called},"expected %n to not have been called but was called %c%C");h("calledOnce","expected %n to be called once but was called %c%C"); h("calledTwice","expected %n to be called twice but was called %c%C");h("calledThrice","expected %n to be called thrice but was called %c%C");h("calledOn","expected %n to be called with %1 as this but was called with %t");h("alwaysCalledOn","expected %n to always be called with %1 as this but was called with %t");h("calledWith","expected %n to be called with arguments %*%C");h("alwaysCalledWith","expected %n to always be called with arguments %*%C");h("calledWithExactly","expected %n to be called with exact arguments %*%C"); h("alwaysCalledWithExactly","expected %n to always be called with exact arguments %*%C");h("neverCalledWith","expected %n to never be called with arguments %*%C");h("threw","%n did not throw exception%C");h("alwaysThrew","%n did not always throw exception%C");g?module.exports=d:b.assert=d}})("object"==typeof j&&j||null,"undefined"!=typeof window?window:global);return j}.call("undefined"!=typeof window&&window||{});
